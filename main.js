!function(){"use strict";class t{constructor(t,e,s,r,i,o){this._title=t.name,this._image=t.link,this._data=t,this._userId=s,this._cardSelector=e,this._handleCardClick=r,this._handleDeleteButton=i,this._handleLikeClick=o,this._likes=this._data.likes,this._like=!1}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}generateCard(){return this._card=this._getTemplate(),this._likeButton=this._card.querySelector(".card__like-button"),this._trashButton=this._card.querySelector(".card__trash-button"),this._photoCard=this._card.querySelector(".card__photo"),this._likeCounter=this._card.querySelector(".card__like-counter"),this._setEventListeners(),this._likeCounter.textContent=this._likes.length,this._photoCard.src=this._image,this._photoCard.alt=this._title,this._card.querySelector(".card__title").textContent=this._title,this._card}_setEventListeners(){this._isLike(),this._likeButton.addEventListener("click",this._handleLikeClick),this._photoCard.addEventListener("click",(()=>this._handleCardClick())),this._data.owner._id===this._userId?this._trashButton.addEventListener("click",this._handleDeleteButton):this._trashButton.style="display: none"}clickLike(t){this._like=!this._like,this._likes=t,this._likeCounter.textContent=t.length,this._likeButton.classList.toggle("card__like-button_active")}_isLike(){this._data.likes.map((t=>t._id)).find((t=>t===this._userId))&&(this._likeButton.classList.add("card__like-button_active"),this._like=!0)}likeIsClicked(){return this._like}clickToRemove(){this._card.remove()}}function e(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class s{constructor(t){e(this,"_handleEscClose",(t=>{"Escape"===t.key&&this.close()})),e(this,"_handleOverlay",(t=>{t.target.classList.contains("popup")&&this.close()})),this._popup=document.querySelector(t),this._closeButton=this._popup.querySelector(".popup__close-button")}open(){this._popup.classList.add("popup_open"),document.addEventListener("keydown",this._handleEscClose),this._popup.addEventListener("mousedown",this._handleOverlay)}close(){this._popup.classList.remove("popup_open"),document.removeEventListener("keydown",this._handleEscClose),this._popup.removeEventListener("mousedown",this._handleOverlay)}setEventListeners(){this._closeButton.addEventListener("click",(()=>this.close()))}}class r extends s{constructor(t,e){super(t),this._submitHandler=e,this._form=this._popup.querySelector(".popup__form"),this._inputList=Array.from(this._form.querySelectorAll(".form__input")),this._submitButton=this._popup.querySelector(".form__button-save"),this._textOnButton=this._submitButton.textContent}_getInputValues(){const t={};return this._inputList.forEach((e=>{t[e.name]=e.value})),t}setInputValues(t){this._inputList.forEach((e=>{e.value=t[e.name]}))}setEventListeners(){this._form.addEventListener("submit",(t=>{t.preventDefault(),this._submitHandler(this._getInputValues()),this.close()})),super.setEventListeners()}close(){super.close(),this._form.reset()}renderLoading(t){this._submitButton.textContent=t?"Saving...":this._textOnButton}}class i{constructor(t,e){this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._formElement=e,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._submitButton=this._formElement.querySelector(this._submitButtonSelector)}enableValidation(){this._formElement.addEventListener("submit",(t=>t.preventDefault())),this._setEventListeners()}_showInputError(t,e){const s=this._formElement.querySelector(".".concat(t.id,"-error"));t.classList.add(this._inputErrorClass),s.textContent=e,s.classList.add(this._errorClass)}_hideInputError(t){const e=this._formElement.querySelector(".".concat(t.id,"-error"));t.classList.remove(this._inputErrorClass),e.classList.remove(this._errorClass),e.textContent=""}_checkInputValidity(t){t.validity.valid?this._hideInputError(t):this._showInputError(t,t.validationMessage)}_setEventListeners(){this._inputList.forEach((t=>{t.addEventListener("input",(()=>{this._checkInputValidity(t),this._toggleButtonState()}))}))}_hasInvalidInput(){return this._inputList.some((t=>!t.validity.valid))}disableButton(){this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0}enableButton(){this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.disabled=!1}_toggleButtonState(){this._hasInvalidInput(this._inputList)?this.disableButton():this.enableButton()}hideError(){this._inputList.forEach((t=>{this._hideInputError(t)}))}}const o=new class{constructor(t){let{baseUrl:e,headers:s}=t;this._baseUrl=e,this._headers=s}_customFetch(t){return t.ok?t.json():Promise.reject("Error: ".concat(t.status))}getUserInfo(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then(this._customFetch)}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then(this._customFetch)}patchUserProfile(t,e){return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:e})}).then(this._customFetch)}createCard(t){let{name:e,link:s}=t;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:s})}).then(this._customFetch)}deleteCard(t){fetch("https://around.nomoreparties.co/v1/cohort-3-en/cards/".concat(t),{method:"DELETE",headers:this._headers})}likeCard(t){return fetch("https://around.nomoreparties.co/v1/cohort-3-en/cards/likes/".concat(t),{method:"PUT",headers:this._headers}).then(this._customFetch)}unLikeCard(t){return fetch("https://around.nomoreparties.co/v1/cohort-3-en/cards/likes/".concat(t),{method:"DELETE",headers:this._headers}).then(this._customFetch)}changeProfilePicture(t){return fetch("https://around.nomoreparties.co/v1/cohort-3-en/users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t})}).then(this._customFetch)}}({baseUrl:"https://around.nomoreparties.co/v1/cohort-3-en",headers:{authorization:"3b82c4e5-0fac-48ec-9210-bfe6ee07c30f","Content-Type":"application/json"}}),n=document.querySelector(".profile__edit-button"),a=document.querySelector(".profile__add-button"),c=document.querySelector(".profile__edit-picture"),h={},l=new class{constructor(t){let{nameSelctor:e,jobSelctor:s}=t;this._profileName=document.querySelector(e),this._profileBreed=document.querySelector(s),this._userAvatar=document.querySelector(".profile__avatar")}getUserInfo(){return{name:this._profileName.textContent,job:this._profileBreed.textContent,avatar:this._userAvatar.src,id:this._userId}}setUserInfo(t,e,s){this._profileName.textContent=t,this._profileBreed.textContent=e,this._userId=s}setUserAvatar(t){this._userAvatar.src=t}}({nameSelctor:".profile__name",jobSelctor:".profile__about-me"}),u=new class{constructor(t,e){this._renderer=t,this._container=document.querySelector(e)}renderCard(t){t.forEach((t=>{this._renderer(t)}))}addInitialItems(t){this._container.append(t)}addNewItem(t){this._container.prepend(t)}}((t=>{u.addInitialItems(_(t))}),".cards");function _(e){const s=l.getUserInfo().id,i=new t(e,"#card-template",s,(()=>{m.open(e.name,e.link)}),(()=>{const t=new r(".popup_type_delete",(()=>{i.clickToRemove(),o.deleteCard(e._id)}));t.open(),t.setEventListeners()}),(()=>{i.likeIsClicked()?o.unLikeCard(e._id).then((t=>{i.clickLike(t.likes)})).catch(console.log):o.likeCard(e._id).then((t=>{i.clickLike(t.likes)})).catch(console.log)}));return i.generateCard()}Promise.all([o.getUserInfo(),o.getInitialCards()]).then((t=>{let[e,s]=t;l.setUserInfo(e.name,e.about,e._id),l.setUserAvatar(e.avatar),u.renderCard(s)})).catch(console.log);const d=new r(".popup_type_profile",(t=>{d.renderLoading(!0),l.setUserInfo(t.name,t["about-me"]),o.patchUserProfile(t.name,t["about-me"]).catch(console.log).finally((()=>{d.renderLoading(!1)}))})),p=new r(".popup_type_cards",(t=>{p.renderLoading(!0);const e={name:t["place-title"],link:t.image};o.createCard(e).then((t=>u.addNewItem(_(t)))).catch(console.log).finally((()=>{d.renderLoading(!1)})),p.close()})),m=new class extends s{constructor(t){super(t),this._popupImg=this._popup.querySelector(".popup__img"),this._popupPhotoTitle=this._popup.querySelector(".popup__photo-title")}open(t,e){super.open(),this._popupImg.src=e,this._popupImg.alt="Beautiful view of ".concat(t),this._popupPhotoTitle.textContent=t}}(".popup_type_photo"),f=new r(".popup_type_avatar",(t=>{f.renderLoading(!0),o.changeProfilePicture(t.image).then((t=>{l.setUserAvatar(t.avatar)})).catch(console.log).finally((()=>{f.renderLoading(!1)}))}));var v;d.setEventListeners(),p.setEventListeners(),m.setEventListeners(),f.setEventListeners(),n.addEventListener("click",(()=>{const t=h["edit-form"];t.hideError(),t.enableButton();const e=l.getUserInfo(),s={name:e.name,"about-me":e.job};d.setInputValues(s),d.open()})),a.addEventListener("click",(()=>{const t=h["add-form"];t.disableButton(),t.hideError(),p.open()})),c.addEventListener("click",(()=>{const t=h["avatar-form"];t.enableButton(),t.hideError(),f.open()})),v={inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_disable",inputErrorClass:"popup__input_type_error",errorClass:"form__input-error_active"},Array.from(document.querySelectorAll(".popup__form")).forEach((t=>{const e=new i(v,t),s=t.getAttribute("name");h[s]=e,e.enableValidation()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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T0FDMUJwRCxNQUFNUixJQUNMMkIsRUFBS1EsY0FBY25DLEVBQUlxQixXQUV4QjhCLE1BQU1DLFFBQVFDLEtBQ2RLLFNBQVEsS0FDUEssRUFBWXJHLGVBQWMsU0FzQ0ZzRyxNQWxDOUJQLEVBQWlCbkgsb0JBQ2pCcUgsRUFBVXJILG9CQUNWMkcsRUFBVzNHLG9CQUNYeUgsRUFBWXpILG9CQUdaaUYsRUFBc0I3RyxpQkFBaUIsU0FBUyxLQUM5QyxNQUFNdUosRUFBdUJ2QyxFQUFlLGFBQzVDdUMsRUFBcUJ4RSxZQUNyQndFLEVBQXFCekUsZUFFckIsTUFBTTBFLEVBQWN2QyxFQUFLckIsY0FDbkJqSSxFQUFPLENBQUVRLEtBQU1xTCxFQUFZckwsS0FBTSxXQUFZcUwsRUFBWWpDLEtBQy9Ed0IsRUFBaUJsRyxlQUFlbEYsR0FFaENvTCxFQUFpQnZILFVBR25Cc0YsRUFBYzlHLGlCQUFpQixTQUFTLEtBQ3RDLE1BQU15SixFQUFvQnpDLEVBQWUsWUFDekN5QyxFQUFrQjdFLGdCQUNsQjZFLEVBQWtCMUUsWUFFbEJrRSxFQUFVekgsVUFHWnVGLEVBQWUvRyxpQkFBaUIsU0FBUyxLQUN2QyxNQUFNMEosRUFBc0IxQyxFQUFlLGVBQzNDMEMsRUFBb0I1RSxlQUNwQjRFLEVBQW9CM0UsWUFDcEJzRSxFQUFZN0gsVUFJZ0I4SCxFRHhJZixDQUNiakcsY0FBZSxlQUNmRSxxQkFBc0IsZ0JBQ3RCRSxvQkFBcUIsdUJBQ3JCRSxnQkFBaUIsMEJBQ2pCRSxXQUFZLDRCQ29JSzFCLE1BQU1DLEtBQUtwRCxTQUFTcUQsaUJBQWlCLGlCQUM3Q0ssU0FBU1MsSUFDaEIsTUFBTXdHLEVBQWdCLElBQUl6RyxFQUFjb0csRUFBUW5HLEdBQzFDeUcsRUFBV3pHLEVBQVkwRyxhQUFhLFFBQzFDN0MsRUFBZTRDLEdBQVlELEVBQzNCQSxFQUFjNUYsc0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0FwaS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3V0aWxpcy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBDYXJkIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIGRhdGEsXHJcbiAgICBjYXJkU2VsZWN0b3IsXHJcbiAgICB1c2VySWQsXHJcbiAgICBoYW5kbGVDYXJkQ2xpY2ssXHJcbiAgICBoYW5kbGVEZWxldGVCdXR0b24sXHJcbiAgICBoYW5kbGVMaWtlQ2xpY2tcclxuICApIHtcclxuICAgIHRoaXMuX3RpdGxlID0gZGF0YS5uYW1lO1xyXG4gICAgdGhpcy5faW1hZ2UgPSBkYXRhLmxpbms7XHJcbiAgICB0aGlzLl9kYXRhID0gZGF0YTtcclxuICAgIHRoaXMuX3VzZXJJZCA9IHVzZXJJZDtcclxuICAgIHRoaXMuX2NhcmRTZWxlY3RvciA9IGNhcmRTZWxlY3RvcjtcclxuICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayA9IGhhbmRsZUNhcmRDbGljaztcclxuICAgIHRoaXMuX2hhbmRsZURlbGV0ZUJ1dHRvbiA9IGhhbmRsZURlbGV0ZUJ1dHRvbjtcclxuICAgIHRoaXMuX2hhbmRsZUxpa2VDbGljayA9IGhhbmRsZUxpa2VDbGljaztcclxuICAgIHRoaXMuX2xpa2VzID0gdGhpcy5fZGF0YS5saWtlczsgLy9hcnJheSBvZiBsaWtlc1xyXG4gICAgdGhpcy5fbGlrZSA9IGZhbHNlOyAvLyBsaWtlIGJ1dHRvbiBub3QgYWN0aXZlXHJcbiAgfVxyXG5cclxuICBfZ2V0VGVtcGxhdGUoKSB7XHJcbiAgICBjb25zdCBjYXJkRWxlbWVudCA9IGRvY3VtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcclxuICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXHJcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XHJcblxyXG4gICAgcmV0dXJuIGNhcmRFbGVtZW50O1xyXG4gIH1cclxuXHJcbiAgZ2VuZXJhdGVDYXJkKCkge1xyXG4gICAgdGhpcy5fY2FyZCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XHJcbiAgICB0aGlzLl9saWtlQnV0dG9uID0gdGhpcy5fY2FyZC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xyXG4gICAgdGhpcy5fdHJhc2hCdXR0b24gPSB0aGlzLl9jYXJkLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdHJhc2gtYnV0dG9uXCIpO1xyXG4gICAgdGhpcy5fcGhvdG9DYXJkID0gdGhpcy5fY2FyZC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3Bob3RvXCIpO1xyXG4gICAgdGhpcy5fbGlrZUNvdW50ZXIgPSB0aGlzLl9jYXJkLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1jb3VudGVyXCIpO1xyXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHRoaXMuX2xpa2VDb3VudGVyLnRleHRDb250ZW50ID0gdGhpcy5fbGlrZXMubGVuZ3RoO1xyXG4gICAgdGhpcy5fcGhvdG9DYXJkLnNyYyA9IHRoaXMuX2ltYWdlO1xyXG4gICAgdGhpcy5fcGhvdG9DYXJkLmFsdCA9IHRoaXMuX3RpdGxlO1xyXG4gICAgdGhpcy5fY2FyZC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpLnRleHRDb250ZW50ID0gdGhpcy5fdGl0bGU7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2NhcmQ7XHJcbiAgfVxyXG5cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9pc0xpa2UoKTtcclxuICAgIC8vbGlrZSBidXR0b25cclxuICAgIHRoaXMuX2xpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2hhbmRsZUxpa2VDbGljayk7XHJcbiAgICAvL3BvcHVwIHBob3RvXHJcbiAgICB0aGlzLl9waG90b0NhcmQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuX2hhbmRsZUNhcmRDbGljaygpKTtcclxuICAgIC8vdHJhc2ggYnV0dG9uXHJcbiAgICBpZiAodGhpcy5fZGF0YS5vd25lcltcIl9pZFwiXSA9PT0gdGhpcy5fdXNlcklkKSB7XHJcbiAgICAgIHRoaXMuX3RyYXNoQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLl9oYW5kbGVEZWxldGVCdXR0b24pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fdHJhc2hCdXR0b24uc3R5bGUgPSBcImRpc3BsYXk6IG5vbmVcIjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNsaWNrTGlrZShhcnJheU9mTGlrZXMpIHtcclxuICAgIHRoaXMuX2xpa2UgPSAhdGhpcy5fbGlrZTtcclxuICAgIHRoaXMuX2xpa2VzID0gYXJyYXlPZkxpa2VzO1xyXG4gICAgdGhpcy5fbGlrZUNvdW50ZXIudGV4dENvbnRlbnQgPSBhcnJheU9mTGlrZXMubGVuZ3RoO1xyXG4gICAgdGhpcy5fbGlrZUJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xyXG4gIH1cclxuXHJcbiAgX2lzTGlrZSgpIHtcclxuICAgIGNvbnN0IHVzZXJMaWtlID0gdGhpcy5fZGF0YS5saWtlc1xyXG4gICAgICAubWFwKCh1c2VyKSA9PiB1c2VyW1wiX2lkXCJdKVxyXG4gICAgICAuZmluZCgoaWQpID0+IGlkID09PSB0aGlzLl91c2VySWQpO1xyXG4gICAgaWYgKHVzZXJMaWtlKSB7XHJcbiAgICAgIHRoaXMuX2xpa2VCdXR0b24uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcclxuICAgICAgdGhpcy5fbGlrZSA9IHRydWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBsaWtlSXNDbGlja2VkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2xpa2U7XHJcbiAgfVxyXG5cclxuICBjbGlja1RvUmVtb3ZlKCkge1xyXG4gICAgdGhpcy5fY2FyZC5yZW1vdmUoKTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGNsYXNzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcihwb3B1cE5hbWUpIHtcclxuICAgIHRoaXMuX3BvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cE5hbWUpO1xyXG4gICAgdGhpcy5fY2xvc2VCdXR0b24gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19jbG9zZS1idXR0b25cIik7XHJcbiAgfVxyXG5cclxuICBvcGVuKCkge1xyXG4gICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LmFkZChcInBvcHVwX29wZW5cIik7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XHJcbiAgICB0aGlzLl9wb3B1cC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHRoaXMuX2hhbmRsZU92ZXJsYXkpO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfb3BlblwiKTtcclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICAgIHRoaXMuX3BvcHVwLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5faGFuZGxlT3ZlcmxheSk7XHJcbiAgfVxyXG5cclxuICBfaGFuZGxlRXNjQ2xvc2UgPSAoZSkgPT4ge1xyXG4gICAgaWYgKGUua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuICB9O1xyXG4gIF9oYW5kbGVPdmVybGF5ID0gKGUpID0+IHtcclxuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cFwiKSkge1xyXG4gICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9jbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5jbG9zZSgpKTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgUG9wdXAgfSBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBOYW1lLCBzdWJtaXRIYW5kbGVyKSB7XHJcbiAgICBzdXBlcihwb3B1cE5hbWUpO1xyXG4gICAgdGhpcy5fc3VibWl0SGFuZGxlciA9IHN1Ym1pdEhhbmRsZXI7XHJcbiAgICB0aGlzLl9mb3JtID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybVwiKTtcclxuICAgIHRoaXMuX2lucHV0TGlzdCA9IEFycmF5LmZyb20odGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yQWxsKFwiLmZvcm1fX2lucHV0XCIpKTtcclxuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbiA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybV9fYnV0dG9uLXNhdmVcIik7XHJcbiAgICB0aGlzLl90ZXh0T25CdXR0b24gPSB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQ7XHJcbiAgfVxyXG4gIF9nZXRJbnB1dFZhbHVlcygpIHtcclxuICAgIGNvbnN0IGxpc3RJbnB1dHNWZWx1ZSA9IHt9O1xyXG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XHJcbiAgICAgIGxpc3RJbnB1dHNWZWx1ZVtpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGxpc3RJbnB1dHNWZWx1ZTtcclxuICB9XHJcblxyXG4gIHNldElucHV0VmFsdWVzKGRhdGEpIHtcclxuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICBpbnB1dC52YWx1ZSA9IGRhdGFbaW5wdXQubmFtZV07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChlKSA9PiB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgdGhpcy5fc3VibWl0SGFuZGxlcih0aGlzLl9nZXRJbnB1dFZhbHVlcygpKTtcclxuICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICBzdXBlci5jbG9zZSgpO1xyXG4gICAgdGhpcy5fZm9ybS5yZXNldCgpO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyTG9hZGluZyhpc0xvYWRpbmcpIHtcclxuICAgIGlmIChpc0xvYWRpbmcpIHtcclxuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZpbmcuLi5cIjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IHRoaXMuX3RleHRPbkJ1dHRvbjtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xyXG4gIGNvbnN0cnVjdG9yKGRhdGEsIGZvcm1FbGVtZW50KSB7XHJcbiAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gZGF0YS5pbnB1dFNlbGVjdG9yO1xyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBkYXRhLnN1Ym1pdEJ1dHRvblNlbGVjdG9yO1xyXG4gICAgdGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyA9IGRhdGEuaW5hY3RpdmVCdXR0b25DbGFzcztcclxuICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IGRhdGEuaW5wdXRFcnJvckNsYXNzO1xyXG4gICAgdGhpcy5fZXJyb3JDbGFzcyA9IGRhdGEuZXJyb3JDbGFzcztcclxuICAgIHRoaXMuX2Zvcm1FbGVtZW50ID0gZm9ybUVsZW1lbnQ7XHJcbiAgICB0aGlzLl9pbnB1dExpc3QgPSBBcnJheS5mcm9tKFxyXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpXHJcbiAgICApO1xyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3JcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBlbmFibGVWYWxpZGF0aW9uKCkge1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZSkgPT4gZS5wcmV2ZW50RGVmYXVsdCgpKTtcclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgfVxyXG5cclxuICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UpIHtcclxuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIGAuJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxyXG4gICAgKTtcclxuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XHJcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9lcnJvckNsYXNzKTtcclxuICB9XHJcblxyXG4gIF9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpIHtcclxuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIGAuJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxyXG4gICAgKTtcclxuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XHJcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9lcnJvckNsYXNzKTtcclxuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XHJcbiAgfVxyXG5cclxuICBfY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCkge1xyXG4gICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XHJcbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIF9oYXNJbnZhbGlkSW5wdXQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5faW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgICByZXR1cm4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZDtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy9jYWxsZWQgZnJvbSBpbmRleC5qcyAtIHB1YmxpYy5cclxuICBkaXNhYmxlQnV0dG9uKCkge1xyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5hZGQodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgZW5hYmxlQnV0dG9uKCkge1xyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIF90b2dnbGVCdXR0b25TdGF0ZSgpIHtcclxuICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQodGhpcy5faW5wdXRMaXN0KSkge1xyXG4gICAgICB0aGlzLmRpc2FibGVCdXR0b24oKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZW5hYmxlQnV0dG9uKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBoaWRlRXJyb3IoKSB7XHJcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIiwiY2xhc3MgQXBpIHtcclxuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xyXG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XHJcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcclxuICB9XHJcblxyXG4gIF9jdXN0b21GZXRjaChyZXMpIHtcclxuICAgIHJldHVybiByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4odGhpcy5fY3VzdG9tRmV0Y2gpO1xyXG4gIH1cclxuXHJcbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSkudGhlbih0aGlzLl9jdXN0b21GZXRjaCk7XHJcbiAgfVxyXG5cclxuICBwYXRjaFVzZXJQcm9maWxlKG5hbWUsIGFib3V0KSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZTogbmFtZSxcclxuICAgICAgICBhYm91dDogYWJvdXQsXHJcbiAgICAgIH0pLFxyXG4gICAgfSkudGhlbih0aGlzLl9jdXN0b21GZXRjaCk7XHJcbiAgfVxyXG5cclxuICBjcmVhdGVDYXJkKHsgbmFtZSwgbGluayB9KSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBuYW1lOiBuYW1lLFxyXG4gICAgICAgIGxpbms6IGxpbmssXHJcbiAgICAgIH0pLFxyXG4gICAgfSkudGhlbih0aGlzLl9jdXN0b21GZXRjaCk7XHJcbiAgfVxyXG5cclxuICBkZWxldGVDYXJkKGlkKSB7XHJcbiAgICBmZXRjaChgaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9jb2hvcnQtMy1lbi9jYXJkcy8ke2lkfWAsIHtcclxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBsaWtlQ2FyZChpZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKFxyXG4gICAgICBgaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9jb2hvcnQtMy1lbi9jYXJkcy9saWtlcy8ke2lkfWAsXHJcbiAgICAgIHtcclxuICAgICAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgfVxyXG4gICAgKS50aGVuKHRoaXMuX2N1c3RvbUZldGNoKTtcclxuICB9XHJcblxyXG4gIHVuTGlrZUNhcmQoaWQpIHtcclxuICAgIHJldHVybiBmZXRjaChcclxuICAgICAgYGh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvY29ob3J0LTMtZW4vY2FyZHMvbGlrZXMvJHtpZH1gLFxyXG4gICAgICB7XHJcbiAgICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIH1cclxuICAgICkudGhlbih0aGlzLl9jdXN0b21GZXRjaCk7XHJcbiAgfVxyXG5cclxuICBjaGFuZ2VQcm9maWxlUGljdHVyZShsaW5rKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goXHJcbiAgICAgIGBodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2NvaG9ydC0zLWVuL3VzZXJzL21lL2F2YXRhcmAsXHJcbiAgICAgIHtcclxuICAgICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgIGF2YXRhcjogbGluayxcclxuICAgICAgICB9KSxcclxuICAgICAgfVxyXG4gICAgKS50aGVuKHRoaXMuX2N1c3RvbUZldGNoKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBhcGkgPSBuZXcgQXBpKHtcclxuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvY29ob3J0LTMtZW5cIixcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBcIjNiODJjNGU1LTBmYWMtNDhlYy05MjEwLWJmZTZlZTA3YzMwZlwiLFxyXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgfSxcclxufSk7XHJcbiIsIi8vcG9wdXAtZWRpdCBwcm9maWxlIHZhcmlhYmxlc1xyXG5jb25zdCBvcGVuUHJvZmlsZUZvcm1CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnV0dG9uXCIpO1xyXG5cclxuLy9wb3B1cCBhZGQgY2FyZCB2YXJpYWJsZXNcclxuY29uc3Qgb3BlbkFkZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcclxuXHJcbi8vcG9wdXAgY2hhbmdlIHByb2ZpbGUgcGljdHVyZVxyXG5cclxuY29uc3Qgb3BlbkVkaXRBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtcGljdHVyZVwiKTtcclxuXHJcbi8vdmFsaWRhdGlvbiB2YXJpYWJsZVxyXG5jb25zdCBjb25maWcgPSB7XHJcbiAgaW5wdXRTZWxlY3RvcjogXCIuZm9ybV9faW5wdXRcIixcclxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIuZm9ybV9fc3VibWl0XCIsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJmb3JtX19zdWJtaXRfZGlzYWJsZVwiLFxyXG4gIGlucHV0RXJyb3JDbGFzczogXCJwb3B1cF9faW5wdXRfdHlwZV9lcnJvclwiLFxyXG4gIGVycm9yQ2xhc3M6IFwiZm9ybV9faW5wdXQtZXJyb3JfYWN0aXZlXCIsXHJcbn07XHJcblxyXG5leHBvcnQgeyBvcGVuUHJvZmlsZUZvcm1CdXR0b24sIG9wZW5BZGRCdXR0b24sIGNvbmZpZywgb3BlbkVkaXRBdmF0YXIgfTtcclxuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcclxuaW1wb3J0IHsgQ2FyZCB9IGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcclxuaW1wb3J0IHsgUG9wdXBXaXRoRm9ybSB9IGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcclxuaW1wb3J0IHsgRm9ybVZhbGlkYXRvciB9IGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcclxuaW1wb3J0IHsgU2VjdGlvbiB9IGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcclxuaW1wb3J0IHsgVXNlckluZm8gfSBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xyXG5pbXBvcnQgeyBQb3B1cFdpdGhJbWFnZSB9IGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XHJcbmltcG9ydCB7IGFwaSB9IGZyb20gXCIuLi9jb21wb25lbnRzL0FwaVwiO1xyXG5pbXBvcnQge1xyXG4gIG9wZW5Qcm9maWxlRm9ybUJ1dHRvbixcclxuICBvcGVuQWRkQnV0dG9uLFxyXG4gIGNvbmZpZyxcclxuICBvcGVuRWRpdEF2YXRhcixcclxufSBmcm9tIFwiLi4vdXRpbGlzL2NvbnN0YW50cy5qc1wiO1xyXG5cclxuY29uc3QgZm9ybVZhbGlkYXRvcnMgPSB7fTtcclxuXHJcbmNvbnN0IGluZm8gPSBuZXcgVXNlckluZm8oe1xyXG4gIG5hbWVTZWxjdG9yOiBcIi5wcm9maWxlX19uYW1lXCIsXHJcbiAgam9iU2VsY3RvcjogXCIucHJvZmlsZV9fYWJvdXQtbWVcIixcclxufSk7XHJcblxyXG5jb25zdCBjYXJkcyA9IG5ldyBTZWN0aW9uKChjYXJkKSA9PiB7XHJcbiAgY2FyZHMuYWRkSW5pdGlhbEl0ZW1zKGNyZWF0ZUNhcmQoY2FyZCkpO1xyXG59LCBcIi5jYXJkc1wiKTtcclxuXHJcblByb21pc2UuYWxsKFthcGkuZ2V0VXNlckluZm8oKSwgYXBpLmdldEluaXRpYWxDYXJkcygpXSlcclxuICAudGhlbigoW3VzZXJEYXRhLCBjYXJkc0RhdGFdKSA9PiB7XHJcbiAgICBpbmZvLnNldFVzZXJJbmZvKHVzZXJEYXRhLm5hbWUsIHVzZXJEYXRhLmFib3V0LCB1c2VyRGF0YVtcIl9pZFwiXSk7XHJcbiAgICBpbmZvLnNldFVzZXJBdmF0YXIodXNlckRhdGEuYXZhdGFyKTtcclxuICAgIGNhcmRzLnJlbmRlckNhcmQoY2FyZHNEYXRhKTtcclxuICB9KVxyXG4gIC5jYXRjaChjb25zb2xlLmxvZyk7XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVDYXJkKGl0ZW0pIHtcclxuICBjb25zdCB1c2VySWQgPSBpbmZvLmdldFVzZXJJbmZvKCkuaWQ7XHJcbiAgY29uc3QgbmV3Q2FyZCA9IG5ldyBDYXJkKFxyXG4gICAgaXRlbSxcclxuICAgIFwiI2NhcmQtdGVtcGxhdGVcIixcclxuICAgIHVzZXJJZCxcclxuICAgICgpID0+IHtcclxuICAgICAgcG9wdXBJbWFnZS5vcGVuKGl0ZW0ubmFtZSwgaXRlbS5saW5rKTtcclxuICAgIH0sXHJcbiAgICAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBvcHVwRGVsZXRlID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIucG9wdXBfdHlwZV9kZWxldGVcIiwgKCkgPT4ge1xyXG4gICAgICAgIG5ld0NhcmQuY2xpY2tUb1JlbW92ZSgpO1xyXG4gICAgICAgIGFwaS5kZWxldGVDYXJkKGl0ZW1bXCJfaWRcIl0pO1xyXG4gICAgICB9KTtcclxuICAgICAgcG9wdXBEZWxldGUub3BlbigpO1xyXG4gICAgICBwb3B1cERlbGV0ZS5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgfSxcclxuICAgICgpID0+IHtcclxuICAgICAgbmV3Q2FyZC5saWtlSXNDbGlja2VkKClcclxuICAgICAgICA/IGFwaVxyXG4gICAgICAgICAgICAudW5MaWtlQ2FyZChpdGVtW1wiX2lkXCJdKVxyXG4gICAgICAgICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICAgICAgbmV3Q2FyZC5jbGlja0xpa2UocmVzLmxpa2VzKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGNvbnNvbGUubG9nKVxyXG4gICAgICAgIDogYXBpXHJcbiAgICAgICAgICAgIC5saWtlQ2FyZChpdGVtW1wiX2lkXCJdKVxyXG4gICAgICAgICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICAgICAgbmV3Q2FyZC5jbGlja0xpa2UocmVzLmxpa2VzKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGNvbnNvbGUubG9nKTtcclxuICAgIH1cclxuICApO1xyXG5cclxuICBjb25zdCBjYXJkRWxlbWVudCA9IG5ld0NhcmQuZ2VuZXJhdGVDYXJkKCk7XHJcbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xyXG59XHJcblxyXG4vL3BvcHVwc1xyXG5cclxuY29uc3QgcG9wdXBFZGl0UHJvZmlsZSA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiLnBvcHVwX3R5cGVfcHJvZmlsZVwiLCAoZGF0YSkgPT4ge1xyXG4gIHBvcHVwRWRpdFByb2ZpbGUucmVuZGVyTG9hZGluZyh0cnVlKTtcclxuICBpbmZvLnNldFVzZXJJbmZvKGRhdGEubmFtZSwgZGF0YVtcImFib3V0LW1lXCJdKTtcclxuICBhcGlcclxuICAgIC5wYXRjaFVzZXJQcm9maWxlKGRhdGEubmFtZSwgZGF0YVtcImFib3V0LW1lXCJdKVxyXG4gICAgLmNhdGNoKGNvbnNvbGUubG9nKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBwb3B1cEVkaXRQcm9maWxlLnJlbmRlckxvYWRpbmcoZmFsc2UpO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxuY29uc3QgcG9wdXBDYXJkID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIucG9wdXBfdHlwZV9jYXJkc1wiLCAoZGF0YSkgPT4ge1xyXG4gIHBvcHVwQ2FyZC5yZW5kZXJMb2FkaW5nKHRydWUpO1xyXG4gIGNvbnN0IG5ld0NhcmQgPSB7IG5hbWU6IGRhdGFbXCJwbGFjZS10aXRsZVwiXSwgbGluazogZGF0YS5pbWFnZSB9O1xyXG4gIGFwaVxyXG4gICAgLmNyZWF0ZUNhcmQobmV3Q2FyZClcclxuICAgIC50aGVuKChyZXMpID0+IGNhcmRzLmFkZE5ld0l0ZW0oY3JlYXRlQ2FyZChyZXMpKSlcclxuICAgIC5jYXRjaChjb25zb2xlLmxvZylcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgcG9wdXBFZGl0UHJvZmlsZS5yZW5kZXJMb2FkaW5nKGZhbHNlKTtcclxuICAgIH0pO1xyXG4gIHBvcHVwQ2FyZC5jbG9zZSgpO1xyXG59KTtcclxuXHJcbmNvbnN0IHBvcHVwSW1hZ2UgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoXCIucG9wdXBfdHlwZV9waG90b1wiKTtcclxuXHJcbmNvbnN0IHBvcHVwQXZhdGFyID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIucG9wdXBfdHlwZV9hdmF0YXJcIiwgKGRhdGEpID0+IHtcclxuICBwb3B1cEF2YXRhci5yZW5kZXJMb2FkaW5nKHRydWUpO1xyXG4gIGFwaVxyXG4gICAgLmNoYW5nZVByb2ZpbGVQaWN0dXJlKGRhdGEuaW1hZ2UpXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGluZm8uc2V0VXNlckF2YXRhcihyZXMuYXZhdGFyKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goY29uc29sZS5sb2cpXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHBvcHVwQXZhdGFyLnJlbmRlckxvYWRpbmcoZmFsc2UpO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxucG9wdXBFZGl0UHJvZmlsZS5zZXRFdmVudExpc3RlbmVycygpO1xyXG5wb3B1cENhcmQuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxucG9wdXBJbWFnZS5zZXRFdmVudExpc3RlbmVycygpO1xyXG5wb3B1cEF2YXRhci5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuLy9ldmVudCBsaXN0ZW5lcnNcclxub3BlblByb2ZpbGVGb3JtQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY29uc3QgcHJvZmlsZUZvcm1WYWxpZGF0b3IgPSBmb3JtVmFsaWRhdG9yc1tcImVkaXQtZm9ybVwiXTtcclxuICBwcm9maWxlRm9ybVZhbGlkYXRvci5oaWRlRXJyb3IoKTtcclxuICBwcm9maWxlRm9ybVZhbGlkYXRvci5lbmFibGVCdXR0b24oKTtcclxuXHJcbiAgY29uc3QgaW5pdGlhbEluZm8gPSBpbmZvLmdldFVzZXJJbmZvKCk7XHJcbiAgY29uc3QgZGF0YSA9IHsgbmFtZTogaW5pdGlhbEluZm8ubmFtZSwgXCJhYm91dC1tZVwiOiBpbml0aWFsSW5mby5qb2IgfTtcclxuICBwb3B1cEVkaXRQcm9maWxlLnNldElucHV0VmFsdWVzKGRhdGEpO1xyXG5cclxuICBwb3B1cEVkaXRQcm9maWxlLm9wZW4oKTtcclxufSk7XHJcblxyXG5vcGVuQWRkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY29uc3QgY2FyZEZvcm1WYWxpZGF0b3IgPSBmb3JtVmFsaWRhdG9yc1tcImFkZC1mb3JtXCJdO1xyXG4gIGNhcmRGb3JtVmFsaWRhdG9yLmRpc2FibGVCdXR0b24oKTtcclxuICBjYXJkRm9ybVZhbGlkYXRvci5oaWRlRXJyb3IoKTtcclxuXHJcbiAgcG9wdXBDYXJkLm9wZW4oKTtcclxufSk7XHJcblxyXG5vcGVuRWRpdEF2YXRhci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGNvbnN0IGF2YXRhckZvcm1WYWxpZGF0b3IgPSBmb3JtVmFsaWRhdG9yc1tcImF2YXRhci1mb3JtXCJdO1xyXG4gIGF2YXRhckZvcm1WYWxpZGF0b3IuZW5hYmxlQnV0dG9uKCk7XHJcbiAgYXZhdGFyRm9ybVZhbGlkYXRvci5oaWRlRXJyb3IoKTtcclxuICBwb3B1cEF2YXRhci5vcGVuKCk7XHJcbn0pO1xyXG5cclxuLy92YWxpZGF0aW9uXHJcbmNvbnN0IGVuYWJsZVZhbGlkYXRpb25Gb3JtID0gKGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwX19mb3JtXCIpKTtcclxuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xyXG4gICAgY29uc3QgdmFsaWRhdG9yRm9ybSA9IG5ldyBGb3JtVmFsaWRhdG9yKGNvbmZpZywgZm9ybUVsZW1lbnQpO1xyXG4gICAgY29uc3QgZm9ybU5hbWUgPSBmb3JtRWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJuYW1lXCIpO1xyXG4gICAgZm9ybVZhbGlkYXRvcnNbZm9ybU5hbWVdID0gdmFsaWRhdG9yRm9ybTtcclxuICAgIHZhbGlkYXRvckZvcm0uZW5hYmxlVmFsaWRhdGlvbigpO1xyXG4gIH0pO1xyXG59O1xyXG5lbmFibGVWYWxpZGF0aW9uRm9ybShjb25maWcpO1xyXG4iLCJleHBvcnQgY2xhc3MgVXNlckluZm8ge1xyXG4gIGNvbnN0cnVjdG9yKHsgbmFtZVNlbGN0b3IsIGpvYlNlbGN0b3IgfSkge1xyXG4gICAgdGhpcy5fcHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWVTZWxjdG9yKTtcclxuICAgIHRoaXMuX3Byb2ZpbGVCcmVlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioam9iU2VsY3Rvcik7XHJcbiAgICB0aGlzLl91c2VyQXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5hbWU6IHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50LFxyXG4gICAgICBqb2I6IHRoaXMuX3Byb2ZpbGVCcmVlZC50ZXh0Q29udGVudCxcclxuICAgICAgYXZhdGFyOiB0aGlzLl91c2VyQXZhdGFyLnNyYyxcclxuICAgICAgaWQ6IHRoaXMuX3VzZXJJZCxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBzZXRVc2VySW5mbyhuYW1lLCBqb2IsIGlkKSB7XHJcbiAgICB0aGlzLl9wcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IG5hbWU7XHJcbiAgICB0aGlzLl9wcm9maWxlQnJlZWQudGV4dENvbnRlbnQgPSBqb2I7XHJcbiAgICB0aGlzLl91c2VySWQgPSBpZDtcclxuICB9XHJcblxyXG4gIHNldFVzZXJBdmF0YXIoYXZhdGFyKSB7XHJcbiAgICB0aGlzLl91c2VyQXZhdGFyLnNyYyA9IGF2YXRhcjtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGNsYXNzIFNlY3Rpb24ge1xyXG4gIGNvbnN0cnVjdG9yKHJlbmRlcmVyLCBjb250YWluZXJTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcclxuICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyQ2FyZChjYXJkcykge1xyXG4gICAgY2FyZHMuZm9yRWFjaCgoY2FyZCkgPT4ge1xyXG4gICAgICB0aGlzLl9yZW5kZXJlcihjYXJkKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYWRkSW5pdGlhbEl0ZW1zKGNhcmQpIHtcclxuICAgIHRoaXMuX2NvbnRhaW5lci5hcHBlbmQoY2FyZCk7XHJcbiAgfVxyXG4gIGFkZE5ld0l0ZW0oY2FyZCkge1xyXG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoY2FyZCk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IFBvcHVwIH0gZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcihwb3B1cE5hbWUpIHtcclxuICAgIHN1cGVyKHBvcHVwTmFtZSk7XHJcbiAgICB0aGlzLl9wb3B1cEltZyA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2ltZ1wiKTtcclxuICAgIHRoaXMuX3BvcHVwUGhvdG9UaXRsZSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX3Bob3RvLXRpdGxlXCIpO1xyXG4gIH1cclxuXHJcbiAgb3BlbihuYW1lLCBsaW5rKSB7XHJcbiAgICBzdXBlci5vcGVuKCk7XHJcbiAgICB0aGlzLl9wb3B1cEltZy5zcmMgPSBsaW5rO1xyXG4gICAgdGhpcy5fcG9wdXBJbWcuYWx0ID0gYEJlYXV0aWZ1bCB2aWV3IG9mICR7bmFtZX1gO1xyXG4gICAgdGhpcy5fcG9wdXBQaG90b1RpdGxlLnRleHRDb250ZW50ID0gbmFtZTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbIkNhcmQiLCJjb25zdHJ1Y3RvciIsImRhdGEiLCJjYXJkU2VsZWN0b3IiLCJ1c2VySWQiLCJoYW5kbGVDYXJkQ2xpY2siLCJoYW5kbGVEZWxldGVCdXR0b24iLCJoYW5kbGVMaWtlQ2xpY2siLCJ0aGlzIiwiX3RpdGxlIiwibmFtZSIsIl9pbWFnZSIsImxpbmsiLCJfZGF0YSIsIl91c2VySWQiLCJfY2FyZFNlbGVjdG9yIiwiX2hhbmRsZUNhcmRDbGljayIsIl9oYW5kbGVEZWxldGVCdXR0b24iLCJfaGFuZGxlTGlrZUNsaWNrIiwiX2xpa2VzIiwibGlrZXMiLCJfbGlrZSIsIl9nZXRUZW1wbGF0ZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJnZW5lcmF0ZUNhcmQiLCJfY2FyZCIsIl9saWtlQnV0dG9uIiwiX3RyYXNoQnV0dG9uIiwiX3Bob3RvQ2FyZCIsIl9saWtlQ291bnRlciIsIl9zZXRFdmVudExpc3RlbmVycyIsInRleHRDb250ZW50IiwibGVuZ3RoIiwic3JjIiwiYWx0IiwiX2lzTGlrZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJvd25lciIsInN0eWxlIiwiY2xpY2tMaWtlIiwiYXJyYXlPZkxpa2VzIiwiY2xhc3NMaXN0IiwidG9nZ2xlIiwibWFwIiwidXNlciIsImZpbmQiLCJpZCIsImFkZCIsImxpa2VJc0NsaWNrZWQiLCJjbGlja1RvUmVtb3ZlIiwicmVtb3ZlIiwiUG9wdXAiLCJwb3B1cE5hbWUiLCJlIiwia2V5IiwiY2xvc2UiLCJ0YXJnZXQiLCJjb250YWlucyIsIl9wb3B1cCIsIl9jbG9zZUJ1dHRvbiIsIm9wZW4iLCJfaGFuZGxlRXNjQ2xvc2UiLCJfaGFuZGxlT3ZlcmxheSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZXRFdmVudExpc3RlbmVycyIsIlBvcHVwV2l0aEZvcm0iLCJzdWJtaXRIYW5kbGVyIiwic3VwZXIiLCJfc3VibWl0SGFuZGxlciIsIl9mb3JtIiwiX2lucHV0TGlzdCIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJfc3VibWl0QnV0dG9uIiwiX3RleHRPbkJ1dHRvbiIsIl9nZXRJbnB1dFZhbHVlcyIsImxpc3RJbnB1dHNWZWx1ZSIsImZvckVhY2giLCJpbnB1dCIsInZhbHVlIiwic2V0SW5wdXRWYWx1ZXMiLCJwcmV2ZW50RGVmYXVsdCIsInJlc2V0IiwicmVuZGVyTG9hZGluZyIsImlzTG9hZGluZyIsIkZvcm1WYWxpZGF0b3IiLCJmb3JtRWxlbWVudCIsIl9pbnB1dFNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsIl9zdWJtaXRCdXR0b25TZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX2luYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiX2lucHV0RXJyb3JDbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsIl9lcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsIl9mb3JtRWxlbWVudCIsImVuYWJsZVZhbGlkYXRpb24iLCJfc2hvd0lucHV0RXJyb3IiLCJpbnB1dEVsZW1lbnQiLCJlcnJvck1lc3NhZ2UiLCJlcnJvckVsZW1lbnQiLCJfaGlkZUlucHV0RXJyb3IiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwidmFsaWRpdHkiLCJ2YWxpZCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX3RvZ2dsZUJ1dHRvblN0YXRlIiwiX2hhc0ludmFsaWRJbnB1dCIsInNvbWUiLCJkaXNhYmxlQnV0dG9uIiwiZGlzYWJsZWQiLCJlbmFibGVCdXR0b24iLCJoaWRlRXJyb3IiLCJhcGkiLCJiYXNlVXJsIiwiaGVhZGVycyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJfY3VzdG9tRmV0Y2giLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0VXNlckluZm8iLCJmZXRjaCIsInRoZW4iLCJnZXRJbml0aWFsQ2FyZHMiLCJwYXRjaFVzZXJQcm9maWxlIiwiYWJvdXQiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZUNhcmQiLCJkZWxldGVDYXJkIiwibGlrZUNhcmQiLCJ1bkxpa2VDYXJkIiwiY2hhbmdlUHJvZmlsZVBpY3R1cmUiLCJhdmF0YXIiLCJhdXRob3JpemF0aW9uIiwib3BlblByb2ZpbGVGb3JtQnV0dG9uIiwib3BlbkFkZEJ1dHRvbiIsIm9wZW5FZGl0QXZhdGFyIiwiZm9ybVZhbGlkYXRvcnMiLCJpbmZvIiwibmFtZVNlbGN0b3IiLCJqb2JTZWxjdG9yIiwiX3Byb2ZpbGVOYW1lIiwiX3Byb2ZpbGVCcmVlZCIsIl91c2VyQXZhdGFyIiwiam9iIiwic2V0VXNlckluZm8iLCJzZXRVc2VyQXZhdGFyIiwiY2FyZHMiLCJyZW5kZXJlciIsImNvbnRhaW5lclNlbGVjdG9yIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsInJlbmRlckNhcmQiLCJjYXJkIiwiYWRkSW5pdGlhbEl0ZW1zIiwiYXBwZW5kIiwiYWRkTmV3SXRlbSIsInByZXBlbmQiLCJpdGVtIiwibmV3Q2FyZCIsInBvcHVwSW1hZ2UiLCJwb3B1cERlbGV0ZSIsImNhdGNoIiwiY29uc29sZSIsImxvZyIsImFsbCIsInVzZXJEYXRhIiwiY2FyZHNEYXRhIiwicG9wdXBFZGl0UHJvZmlsZSIsImZpbmFsbHkiLCJwb3B1cENhcmQiLCJpbWFnZSIsIl9wb3B1cEltZyIsIl9wb3B1cFBob3RvVGl0bGUiLCJwb3B1cEF2YXRhciIsImNvbmZpZyIsInByb2ZpbGVGb3JtVmFsaWRhdG9yIiwiaW5pdGlhbEluZm8iLCJjYXJkRm9ybVZhbGlkYXRvciIsImF2YXRhckZvcm1WYWxpZGF0b3IiLCJ2YWxpZGF0b3JGb3JtIiwiZm9ybU5hbWUiLCJnZXRBdHRyaWJ1dGUiXSwic291cmNlUm9vdCI6IiJ9